<?xml version="1.0"?>

<robot name="quadcopter" xmlns:xacro="http://ros.org/wiki/xacro">

  <xacro:property name="namespace" value="$(arg namespace)" />
  <!-- includes definition of sensors xacros and Math {-->
    <!-- macros for gazebo plugins, sensors -->
    
    <xacro:include filename="$(arg mrs_robots_description_dir)/urdf/component_snippets.xacro" />
  <!--}-->

  <!-- ================================================================== -->
  <!-- ||                    parameters definition                     || -->
  <!-- ================================================================== -->

  <!-- Robot parameters and arguments {-->
  <xacro:property name="mass" value="1.35" /> <!-- [kg] -->
  <xacro:property name="body_radius" value="0.08" /> <!-- [m] -->
  <xacro:property name="body_height" value="0.07" /> <!-- [m] -->
  <xacro:property name="mass_rotor" value="0.005" /> <!-- [kg] -->
  <xacro:property name="radius_rotor" value="0.093" /> <!-- [m] -->
  <xacro:property name="rotor_offset_top" value="0.017" /> <!-- [m] -->
  <xacro:property name="arm_length" value="0.165" /> <!-- [m] -->
  <xacro:property name="arm_height" value="0.038" /> <!-- [m] -->
  <xacro:property name="board_radius" value="0.065" /> <!-- [m] -->
  <xacro:property name="board_height" value="0.002" /> <!-- [m] -->
  <xacro:property name="holder_offset" value="0.02" /> <!-- [m] -->
  <xacro:property name="leg_length" value="0.11" /> <!-- [m] -->
  <xacro:property name="leg_radius" value="0.006" /> <!-- [m] -->
  <xacro:property name="pixhawk_offset" value="0.0073" /> <!-- [m] -->
  <xacro:property name="propeller_offset_z" value="0.035" /> <!-- [m] -->

  <!-- Motor constants {-->
  <xacro:property name="rotor_velocity_slowdown_sim" value="0.0159236" />
  <xacro:property name="motor_constant" value="8.91" /> <!-- [kg.m/s^2] -->
  <xacro:property name="moment_constant" value="0.016" /> <!-- [m] -->
  <xacro:property name="time_constant_up" value="${1.0 / 80.0}" /> <!-- [s] -->
  <xacro:property name="time_constant_down" value="${1.0 / 40.0}" /> <!-- [s] -->
  <xacro:property name="max_rot_velocity" value="1" /> <!-- [rad/s] -->
  <xacro:property name="rotor_drag_coefficient" value="0.001" /> <!--orig 8.06428e-04 -->
  <xacro:property name="rolling_moment_coefficient" value="1.0e-6" />
  <!--}-->

  <!-- Inertia constants {-->
  <xacro:property name="inertia_body_radius" value="0.20" /> <!-- [m] -->
  <xacro:property name="inertia_body_height" value="0.075" /> <!-- [m] -->
  <!--}-->
  !-- ================================================================== -->
  <!-- ||                    bare body definitions                     || -->
  <!-- ================================================================== -->

  <!-- Inertia blocks {-->
  <!-- cylinder body -->
  <xacro:property name="body_inertia">
    <inertia
      ixx="${mass * (3 * inertia_body_radius * inertia_body_radius + inertia_body_height * inertia_body_height) / 12}"
      iyy="${mass * (3 * inertia_body_radius * inertia_body_radius + inertia_body_height * inertia_body_height) / 12}"
      izz="${mass * inertia_body_radius * inertia_body_radius / 2}"
      ixy="0" ixz="0" iyz="0"/>
  </xacro:property>

  <!-- inertia of a single rotor, assuming it is a cuboid. Height=3mm, width=15mm -->
  <xacro:property name="rotor_inertia">
    <!-- <inertia -->
      <!--   ixx="${1/12 * mass_rotor * (0.015 * 0.015 + 0.003 * 0.003) * rotor_velocity_slowdown_sim}" -->
      <!--   iyy="${1/12 * mass_rotor * (4 * radius_rotor * radius_rotor + 0.003 * 0.003) * rotor_velocity_slowdown_sim}" -->
      <!--   izz="${1/12 * mass_rotor * (4 * radius_rotor * radius_rotor + 0.015 * 0.015) * rotor_velocity_slowdown_sim}" -->
      <!--   ixy="0.0" ixz="0.0"  iyz="0.0" /> -->
    <!-- [kg.m^2] [kg.m^2] [kg.m^2] [kg.m^2] [kg.m^2] [kg.m^2] -->
    <inertia ixx="0.0001" ixy="0.0" ixz="0.0" iyy="0.0001" iyz="0.0" izz="0.0001" /> <!-- [kg.m^2] [kg.m^2] [kg.m^2] [kg.m^2] [kg.m^2] [kg.m^2] -->
  </xacro:property>

  <!-- Instantiate multirotor_base_macro {-->
  <xacro:multirotor_base_without_mesh_macro
    robot_namespace="${namespace}"
    mass="${mass}"
    body_radius="${body_radius}"
    body_height="${body_height}"
    >
    <xacro:insert_block name="body_inertia" />
  </xacro:multirotor_base_without_mesh_macro>

  <!-- VISUALIZATION {-->
  <xacro:visual_macro
    robot_namespace="${namespace}"
    name="lower_central_board"
    mesh_file="${central_board_mesh_bottom}"
    mesh_scale="${mesh_scale}"
    parent="base_link"
    color="DarkGrey">
    <origin xyz="0 0 0.001" rpy="0 0 ${-rad90}" />
  </xacro:visual_macro>
  <link name="base_link">
  <inertial>
    <origin xyz="-0.0006903853886181631 1.1851569493097096e-07 0.0158898738841376" rpy="0 0 0"/>
    <mass value="0.15979566677779333"/>
    <inertia ixx="0.015" iyy="0.015" izz="0.015" ixy="0.0" iyz="-0.0" ixz="0"/>
  </inertial>
  <visual>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="plastic_glossy_grey"/>
  </visual>
  <collision>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/base_link.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="MotorBody1_1">
  <inertial>
    <origin xyz="-7.104954874437297e-09 -1.2561942860922493e-07 0.009032452917808433" rpy="0 0 0"/>
    <mass value="0.039393688131287526"/>
    <inertia ixx="3e-06" iyy="3e-06" izz="2e-06" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="0.076368 -0.099475 -0.004" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/MotorBody1_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="steel_satin"/>
  </visual>
  <collision>
    <origin xyz="0.076368 -0.099475 -0.004" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/MotorBody1_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="MotorBody2_1">
  <inertial>
    <origin xyz="-5.5465372350571585e-08 -1.256194286369805e-07 0.009032452917808433" rpy="0 0 0"/>
    <mass value="0.039393688131287526"/>
    <inertia ixx="3e-06" iyy="3e-06" izz="2e-06" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="-0.077777 -0.099475 -0.004" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/MotorBody2_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="steel_satin"/>
  </visual>
  <collision>
    <origin xyz="-0.077777 -0.099475 -0.004" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/MotorBody2_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="MotorBody3_1">
  <inertial>
    <origin xyz="-4.0403642478925583e-07 9.77353151465632e-08 0.009032452917808458" rpy="0 0 0"/>
    <mass value="0.039393688131287526"/>
    <inertia ixx="3e-06" iyy="3e-06" izz="2e-06" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="-0.077777 0.099475 -0.004" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/MotorBody3_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="steel_satin"/>
  </visual>
  <collision>
    <origin xyz="-0.077777 0.099475 -0.004" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/MotorBody3_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="MotorBody4_1">
  <inertial>
    <origin xyz="-3.556750609312598e-07 -3.621236610434897e-07 0.00903245291780843" rpy="0 0 0"/>
    <mass value="0.039393688131287526"/>
    <inertia ixx="3e-06" iyy="3e-06" izz="2e-06" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="0.076368 0.099474 -0.004" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/MotorBody4_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="steel_satin"/>
  </visual>
  <collision>
    <origin xyz="0.076368 0.099474 -0.004" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/MotorBody4_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="battery_1">
  <inertial>
    <origin xyz="-5.265607921245419e-08 1.9420724012286783e-07 0.018500000000000093" rpy="0 0 0"/>
    <mass value="0.19501405000000005"/>
    <inertia ixx="4.4e-05" iyy="0.000119" izz="0.000119" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="0.0 -0.0 -0.003" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/battery_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="fr4"/>
  </visual>
  <collision>
    <origin xyz="0.0 -0.0 -0.003" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/battery_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="PCB_1">
  <inertial>
    <origin xyz="0.0030672422684746804 -2.3655530857361677e-07 -0.001" rpy="0 0 0"/>
    <mass value="0.08999975260520511"/>
    <inertia ixx="1.1e-05" iyy="4.8e-05" izz="5.9e-05" ixy="-0.0" iyz="-0.0" ixz="0.0"/>
  </inertial>
  <visual>
    <origin xyz="0.0 0.0 -0.0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/PCB_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="fr4"/>
  </visual>
  <collision>
    <origin xyz="0.0 0.0 -0.0" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/PCB_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="prop1_1">
  <inertial>
    <origin xyz="-1.0456199399377919e-07 -1.3696856718259376e-07 -5.9485495865846394e-05" rpy="0 0 0"/>
    <mass value="0.003145605918476553"/>
    <inertia ixx="0.0" iyy="2e-06" izz="2e-06" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="0.076368 -0.099475 -0.03342" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/prop1_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="abs_white"/>
  </visual>
  <collision>
    <origin xyz="0.076368 -0.099475 -0.03342" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/prop1_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="prop2_1">
  <inertial>
    <origin xyz="-1.5292241152542463e-07 -1.3696856722422712e-07 -5.948549586579782e-05" rpy="0 0 0"/>
    <mass value="0.0031456059184765506"/>
    <inertia ixx="0.0" iyy="2e-06" izz="2e-06" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="-0.077777 -0.099475 -0.03342" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/prop2_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="abs_white"/>
  </visual>
  <collision>
    <origin xyz="-0.077777 -0.099475 -0.03342" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/prop2_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="prop3_1">
  <inertial>
    <origin xyz="-5.014934639918645e-07 8.638617657319436e-08 -5.9485495865777005e-05" rpy="0 0 0"/>
    <mass value="0.0031456059184765506"/>
    <inertia ixx="0.0" iyy="2e-06" izz="2e-06" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="-0.077777 0.099475 -0.03342" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/prop3_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="abs_white"/>
  </visual>
  <collision>
    <origin xyz="-0.077777 0.099475 -0.03342" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/prop3_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<link name="prop4_1">
  <inertial>
    <origin xyz="-4.5313210006447946e-07 -3.7347279961685853e-07 -5.948549586579088e-05" rpy="0 0 0"/>
    <mass value="0.0031456059184765506"/>
    <inertia ixx="0.0" iyy="2e-06" izz="2e-06" ixy="0.0" iyz="-0.0" ixz="-0.0"/>
  </inertial>
  <visual>
    <origin xyz="0.076368 0.099474 -0.03342" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/prop4_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
    <material name="abs_white"/>
  </visual>
  <collision>
    <origin xyz="0.076368 0.099474 -0.03342" rpy="0 0 0"/>
    <geometry>
      <mesh filename="package://quadcopter_description/meshes/prop4_1.stl" scale="0.001 0.001 0.001"/>
    </geometry>
  </collision>
</link>

<joint name="MotorFixed1" type="fixed">
  <origin xyz="-0.076368 0.099475 0.004" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="MotorBody1_1"/>
</joint>

<joint name="MotorFixed2" type="fixed">
  <origin xyz="0.077777 0.099475 0.004" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="MotorBody2_1"/>
</joint>

<joint name="MotorFixed3" type="fixed">
  <origin xyz="0.077777 -0.099475 0.004" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="MotorBody3_1"/>
</joint>

<joint name="MotorFixed4" type="fixed">
  <origin xyz="-0.076368 -0.099474 0.004" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="MotorBody4_1"/>
</joint>

<joint name="BatteryFixed" type="fixed">
  <origin xyz="0.0 0.0 0.003" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="battery_1"/>
</joint>

<joint name="PCBFixed" type="fixed">
  <origin xyz="0.0 0.0 0.0" rpy="0 0 0"/>
  <parent link="base_link"/>
  <child link="PCB_1"/>
</joint>

<joint name="MotorJoint1" type="continuous">
  <origin xyz="0.0 0.0 0.02942" rpy="0 0 0"/>
  <parent link="MotorBody1_1"/>
  <child link="prop1_1"/>
  <axis xyz="0.0 -0.0 1.0"/>
</joint>

<joint name="MotorJoint2" type="continuous">
  <origin xyz="0.0 0.0 0.02942" rpy="0 0 0"/>
  <parent link="MotorBody2_1"/>
  <child link="prop2_1"/>
  <axis xyz="-0.0 -0.0 1.0"/>
</joint>

<joint name="MotorJoint3" type="continuous">
  <origin xyz="0.0 0.0 0.02942" rpy="0 0 0"/>
  <parent link="MotorBody3_1"/>
  <child link="prop3_1"/>
  <axis xyz="0.0 0.0 1.0"/>
</joint>

<joint name="MotorJoint4" type="continuous">
  <origin xyz="0.0 0.0 0.02942" rpy="0 0 0"/>
  <parent link="MotorBody4_1"/>
  <child link="prop4_1"/>
  <axis xyz="0.0 0.0 1.0"/>
</joint>

</robot>
